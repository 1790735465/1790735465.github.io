<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Docker学习 | csde`Blog</title><meta name="description" content="DockerFileDockerFile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。  DockerFile构建过程1234567FROM centosVOLUME [&quot;volume01&quot;,&quot;volume02&quot;]CMD echo  &quot;---end---&quot;CMD &#x2F;bin&#x2F;bash  1、编写DockerFile文件 2、docker build 构建镜像 3、docker"><meta name="author" content="csde`Blog"><meta name="copyright" content="csde`Blog"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Docker学习"><meta name="twitter:description" content="DockerFileDockerFile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。  DockerFile构建过程1234567FROM centosVOLUME [&quot;volume01&quot;,&quot;volume02&quot;]CMD echo  &quot;---end---&quot;CMD &#x2F;bin&#x2F;bash  1、编写DockerFile文件 2、docker build 构建镜像 3、docker"><meta name="twitter:image" content="https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=4135708617,3847637319&amp;fm=26&amp;gp=0.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Docker学习"><meta property="og:url" content="https://www.csde.vip/posts/1736621668/"><meta property="og:site_name" content="csde`Blog"><meta property="og:description" content="DockerFileDockerFile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。  DockerFile构建过程1234567FROM centosVOLUME [&quot;volume01&quot;,&quot;volume02&quot;]CMD echo  &quot;---end---&quot;CMD &#x2F;bin&#x2F;bash  1、编写DockerFile文件 2、docker build 构建镜像 3、docker"><meta property="og:image" content="https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=4135708617,3847637319&amp;fm=26&amp;gp=0.jpg"><meta property="article:published_time" content="2020-07-30T03:07:11.000Z"><meta property="article:modified_time" content="2020-07-30T03:07:11.000Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://www.csde.vip/posts/1736621668/"><link rel="prev" title="POI及EasyExcel学习" href="https://www.csde.vip/posts/322094917/"><link rel="next" title="Centos安装Dokcer" href="https://www.csde.vip/posts/1565438925/"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b249631a415c6119f6f5e4ece6c4bc92";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://blog.csdn.net/weixin_45736927","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/1790735465/static/css/icon.css"><meta name="generator" content="Hexo 4.2.1"></head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">25</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">11</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-rocket" aria-hidden="true"></i><span> 统计</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/bangumis/"><i class="fa-fw fa fa-file-movie-o"></i><span> 番剧</span></a></li><li><a class="site-page" href="/404/"><i class="fa-fw fa fa-times"></i><span> 404</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DockerFile"><span class="toc-number">1.</span> <span class="toc-text">DockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile构建过程"><span class="toc-number">1.1.</span> <span class="toc-text">DockerFile构建过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile指令"><span class="toc-number">1.2.</span> <span class="toc-text">DockerFile指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CMD和ENTRYPOINT区别"><span class="toc-number">1.3.</span> <span class="toc-text">CMD和ENTRYPOINT区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#测试CMD"><span class="toc-number">1.3.1.</span> <span class="toc-text">测试CMD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试ENTRYPOINT"><span class="toc-number">1.3.2.</span> <span class="toc-text">测试ENTRYPOINT</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战练习-制作自己的镜像"><span class="toc-number">1.4.</span> <span class="toc-text">实战练习(制作自己的镜像)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#制作一个centos镜像"><span class="toc-number">1.4.1.</span> <span class="toc-text">制作一个centos镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#编写DockerFile文件"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">编写DockerFile文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#构建自己的centos镜像"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">构建自己的centos镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运行自己的centos镜像"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">运行自己的centos镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-history"><span class="toc-number">1.4.1.4.</span> <span class="toc-text">Docker history</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#制作tomcat镜像"><span class="toc-number">1.4.2.</span> <span class="toc-text">制作tomcat镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#准备镜像文件-tomcat压缩包-jdk压缩包"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">准备镜像文件,tomcat压缩包,jdk压缩包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编写Dockerfile文件"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">编写Dockerfile文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#构建自己的tomcat镜像"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">构建自己的tomcat镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运行自己的tomcat镜像"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">运行自己的tomcat镜像</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker网络"><span class="toc-number">2.</span> <span class="toc-text">Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker0"><span class="toc-number">2.1.</span> <span class="toc-text">Docker0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#服务器是否可以ping通里面的容器"><span class="toc-number">2.2.</span> <span class="toc-text">服务器是否可以ping通里面的容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器之间是否可以ping通"><span class="toc-number">2.3.</span> <span class="toc-text">容器之间是否可以ping通</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#发现问题"><span class="toc-number">2.4.</span> <span class="toc-text">发现问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#–link"><span class="toc-number">2.5.</span> <span class="toc-text">–link</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义网络"><span class="toc-number">2.6.</span> <span class="toc-text">自定义网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#网络的基本命令查看"><span class="toc-number">2.6.1.</span> <span class="toc-text">网络的基本命令查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看所有的网络"><span class="toc-number">2.6.2.</span> <span class="toc-text">查看所有的网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建一个网络"><span class="toc-number">2.6.3.</span> <span class="toc-text">创建一个网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义网络的好处"><span class="toc-number">2.6.4.</span> <span class="toc-text">自定义网络的好处</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网络连通"><span class="toc-number">2.7.</span> <span class="toc-text">网络连通</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#启动2个默认网络的容器"><span class="toc-number">2.7.1.</span> <span class="toc-text">启动2个默认网络的容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#将容器连接到网络"><span class="toc-number">2.7.2.</span> <span class="toc-text">将容器连接到网络</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实战"><span class="toc-number">3.</span> <span class="toc-text">实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#部署一个redis集群"><span class="toc-number">3.1.</span> <span class="toc-text">部署一个redis集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建redis自己的网络"><span class="toc-number">3.1.1.</span> <span class="toc-text">创建redis自己的网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通过脚本创建六个redis配置"><span class="toc-number">3.1.2.</span> <span class="toc-text">通过脚本创建六个redis配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动6个redis容器"><span class="toc-number">3.1.3.</span> <span class="toc-text">启动6个redis容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建集群"><span class="toc-number">3.1.4.</span> <span class="toc-text">创建集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Springboot项目打包发布"><span class="toc-number">3.2.</span> <span class="toc-text">Springboot项目打包发布</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#编写Dockerfile文件-1"><span class="toc-number">3.2.1.</span> <span class="toc-text">编写Dockerfile文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#项目打包"><span class="toc-number">3.2.2.</span> <span class="toc-text">项目打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构建容器"><span class="toc-number">3.2.3.</span> <span class="toc-text">构建容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运行容器"><span class="toc-number">3.2.4.</span> <span class="toc-text">运行容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#访问测试"><span class="toc-number">3.2.5.</span> <span class="toc-text">访问测试</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="color"></div><div class="post-bg" id="nav" style="background-image: url(https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=4135708617,3847637319&amp;fm=26&amp;gp=0.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">csde`Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-rocket" aria-hidden="true"></i><span> 统计</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/bangumis/"><i class="fa-fw fa fa-file-movie-o"></i><span> 番剧</span></a></li><li><a class="site-page" href="/404/"><i class="fa-fw fa fa-times"></i><span> 404</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Docker学习</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-07-30 11:07:11"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-07-30</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-30 11:07:11"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-07-30</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Docker/">Docker</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">5.8k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 31 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/posts/1736621668/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/posts/1736621668/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h1><p>DockerFile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。 </p>
<h2 id="DockerFile构建过程"><a href="#DockerFile构建过程" class="headerlink" title="DockerFile构建过程"></a>DockerFile构建过程</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"volume01"</span>,<span class="string">"volume02"</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">echo</span>  <span class="string">"---end---"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> /bin/bash</span></span><br></pre></td></tr></table></figure>

<p>1、编写DockerFile文件</p>
<p>2、docker build 构建镜像</p>
<p>3、docker run </p>
<h2 id="DockerFile指令"><a href="#DockerFile指令" class="headerlink" title="DockerFile指令"></a>DockerFile指令</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> <span class="comment"># 基础镜像，当前新镜像是基于哪个镜像的 </span></span><br><span class="line"><span class="keyword">MAINTAINER</span> <span class="comment"># 镜像维护者的姓名混合邮箱地址 </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="comment"># 容器构建时需要运行的命令 </span></span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="comment"># 当前容器对外保留出的端口 </span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="comment"># 指定在创建容器后，终端默认登录的进来工作目录，一个落脚点 </span></span></span><br><span class="line"><span class="keyword">ENV</span> <span class="comment"># 用来在构建镜像过程中设置环境变量 </span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="comment"># 将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包 </span></span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> <span class="comment"># 类似ADD，拷贝文件和目录到镜像中！ </span></span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> <span class="comment"># 容器数据卷，用于数据保存和持久化工作 </span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="comment"># 指定一个容器启动时要运行的命令，dockerFile中可以有多个CMD指令，但只有最 后一个生效！ </span></span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="comment"># 指定一个容器启动时要运行的命令！和CMD一样 </span></span></span><br><span class="line"><span class="keyword">ONBUILD</span> <span class="comment"># 当构建一个被继承的DockerFile时运行命令，父镜像在被子镜像继承后，父镜像的 ONBUILD被触发</span></span><br></pre></td></tr></table></figure>

<h2 id="CMD和ENTRYPOINT区别"><a href="#CMD和ENTRYPOINT区别" class="headerlink" title="CMD和ENTRYPOINT区别"></a>CMD和ENTRYPOINT区别</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="comment"># 指定一个容器启动时要运行的命令，dockerFile中可以有多个CMD指令，但只有最 后一个生效！  (替换)</span></span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="comment"># 指定一个容器启动时要运行的命令！和CMD一样 							    (追加)</span></span></span><br></pre></td></tr></table></figure>



<h3 id="测试CMD"><a href="#测试CMD" class="headerlink" title="测试CMD"></a>测试CMD</h3><p>1、编写dockerfile-cmd-text文件</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"ls"</span>,<span class="string">"-a"</span>]</span></span><br></pre></td></tr></table></figure>

<p>2、构建cmd命令镜像</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker build -f dockerfile-cmd-text -t cmd .</span><br><span class="line"></span><br><span class="line">[root@xingzhen dockerfile]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">cmd                   latest              cbbe25cb9846        29 seconds ago      215MB</span><br></pre></td></tr></table></figure>

<p>3、运行镜像</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen dockerfile]<span class="comment"># docker run -it cmd 	#启动容器直接列出文件</span></span><br><span class="line">.   .dockerenv	dev  home  lib64       media  opt   root  sbin	sys  usr</span><br><span class="line">..  bin		etc  lib   lost+found  mnt    proc  <span class="keyword">run</span><span class="bash">   srv	tmp  var</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行的后面加参数</span></span><br><span class="line">[root@xingzhen dockerfile]<span class="comment"># docker run -it cmd -l	#运行的时候追加-l,进行报错</span></span><br><span class="line">docker: Error response <span class="keyword">from</span> daemon: OCI runtime create failed: container_linux.go:<span class="number">349</span>: starting container process caused <span class="string">"exec: \"-l\": executable file not found in $PATH"</span>: unknown.</span><br></pre></td></tr></table></figure>

<h3 id="测试ENTRYPOINT"><a href="#测试ENTRYPOINT" class="headerlink" title="测试ENTRYPOINT"></a>测试ENTRYPOINT</h3><p>entrypoint</p>
<p>1、编写docker-entrypoint-text文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT ["ls","-a"]</span><br></pre></td></tr></table></figure>

<p>2、构建entrypoint命令镜像</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker build -f docker-<span class="keyword">entrypoint</span><span class="bash">-text -t entrypoint .</span></span><br><span class="line"></span><br><span class="line">[root@xingzhen dockerfile]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line"><span class="keyword">entrypoint</span><span class="bash">            latest              ba9cd1e816ed        27 seconds ago      215MB</span></span><br></pre></td></tr></table></figure>

<p>3、运行镜像</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen dockerfile]<span class="comment"># docker run -it entrypoint	#启动容器直接列出文件,和CMD没有什么区别</span></span><br><span class="line">.   .dockerenv	dev  home  lib64       media  opt   root  sbin	sys  usr</span><br><span class="line">..  bin		etc  lib   lost+found  mnt    proc  <span class="keyword">run</span><span class="bash">   srv	tmp  var</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行的时候加参数</span></span><br><span class="line">[root@xingzhen dockerfile]<span class="comment"># docker run -it entrypoint -l</span></span><br><span class="line">total <span class="number">56</span></span><br><span class="line">drwxr-xr-x   <span class="number">1</span> root root <span class="number">4096</span> Jul <span class="number">25</span> <span class="number">07</span>:<span class="number">57</span> .</span><br><span class="line">drwxr-xr-x   <span class="number">1</span> root root <span class="number">4096</span> Jul <span class="number">25</span> <span class="number">07</span>:<span class="number">57</span> ..</span><br><span class="line">-rwxr-xr-x   <span class="number">1</span> root root    <span class="number">0</span> Jul <span class="number">25</span> <span class="number">07</span>:<span class="number">57</span> .dockerenv</span><br><span class="line">lrwxrwxrwx   <span class="number">1</span> root root    <span class="number">7</span> May <span class="number">11</span>  <span class="number">2019</span> bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   <span class="number">5</span> root root  <span class="number">360</span> Jul <span class="number">25</span> <span class="number">07</span>:<span class="number">57</span> dev</span><br><span class="line">drwxr-xr-x   <span class="number">1</span> root root <span class="number">4096</span> Jul <span class="number">25</span> <span class="number">07</span>:<span class="number">57</span> etc</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root <span class="number">4096</span> May <span class="number">11</span>  <span class="number">2019</span> home</span><br><span class="line">lrwxrwxrwx   <span class="number">1</span> root root    <span class="number">7</span> May <span class="number">11</span>  <span class="number">2019</span> lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   <span class="number">1</span> root root    <span class="number">9</span> May <span class="number">11</span>  <span class="number">2019</span> lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   <span class="number">2</span> root root <span class="number">4096</span> Jun <span class="number">11</span> <span class="number">02</span>:<span class="number">35</span> lost+found</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root <span class="number">4096</span> May <span class="number">11</span>  <span class="number">2019</span> media</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root <span class="number">4096</span> May <span class="number">11</span>  <span class="number">2019</span> mnt</span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root <span class="number">4096</span> May <span class="number">11</span>  <span class="number">2019</span> opt</span><br><span class="line">dr-xr-xr-x <span class="number">102</span> root root    <span class="number">0</span> Jul <span class="number">25</span> <span class="number">07</span>:<span class="number">57</span> proc</span><br><span class="line">dr-xr-x---   <span class="number">2</span> root root <span class="number">4096</span> Jun <span class="number">11</span> <span class="number">02</span>:<span class="number">35</span> root</span><br><span class="line">drwxr-xr-x  <span class="number">11</span> root root <span class="number">4096</span> Jun <span class="number">11</span> <span class="number">02</span>:<span class="number">35</span> <span class="keyword">run</span></span><br><span class="line"><span class="bash">lrwxrwxrwx   1 root root    8 May 11  2019 sbin -&gt; usr/sbin</span></span><br><span class="line">drwxr-xr-x   <span class="number">2</span> root root <span class="number">4096</span> May <span class="number">11</span>  <span class="number">2019</span> srv</span><br><span class="line">dr-xr-xr-x  <span class="number">13</span> root root    <span class="number">0</span> Jul <span class="number">24</span> <span class="number">11</span>:<span class="number">52</span> sys</span><br><span class="line">drwxrwxrwt   <span class="number">7</span> root root <span class="number">4096</span> Jun <span class="number">11</span> <span class="number">02</span>:<span class="number">35</span> tmp</span><br><span class="line">drwxr-xr-x  <span class="number">12</span> root root <span class="number">4096</span> Jun <span class="number">11</span> <span class="number">02</span>:<span class="number">35</span> usr</span><br><span class="line">drwxr-xr-x  <span class="number">20</span> root root <span class="number">4096</span> Jun <span class="number">11</span> <span class="number">02</span>:<span class="number">35</span> var</span><br></pre></td></tr></table></figure>



<h2 id="实战练习-制作自己的镜像"><a href="#实战练习-制作自己的镜像" class="headerlink" title="实战练习(制作自己的镜像)"></a>实战练习(制作自己的镜像)</h2><h3 id="制作一个centos镜像"><a href="#制作一个centos镜像" class="headerlink" title="制作一个centos镜像"></a>制作一个centos镜像</h3><p><strong>查看下官方默认的CentOS的情况：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen /]# docker run -it centos  #运行官方的centos镜像</span><br><span class="line">[root@59fa88576b34 /]# pwd				  #默认工作目录</span><br><span class="line">/</span><br><span class="line">[root@59fa88576b34 /]# ifconfig			#命令无法使用,因为官方的cnetos是压缩版</span><br><span class="line">bash: ifconfig: command not found</span><br><span class="line">[root@59fa88576b34 /]# vim</span><br><span class="line">bash: vim: command not found</span><br><span class="line">[root@59fa88576b34 /]#</span><br></pre></td></tr></table></figure>

<h4 id="编写DockerFile文件"><a href="#编写DockerFile文件" class="headerlink" title="编写DockerFile文件"></a>编写DockerFile文件</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen dockerfile]<span class="comment"># cat  mydcoker-centos </span></span><br><span class="line"><span class="keyword">FROM</span> centos		<span class="comment">#初始镜像</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> csde&lt;<span class="number">1790735465</span>@qq.com&gt;		<span class="comment">#制作镜像的作者名字及邮箱</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local   <span class="comment">#配置环境变量的目录</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$MYPATH</span>	        <span class="comment">#默认工作目录</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install vim    <span class="comment">#安装vim,官方的centos没有vim命令</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install net-tools <span class="comment">#安装ipconfig命令</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span>  <span class="number">80</span>  <span class="comment">#暴露端口号</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"----构建完成--------"</span>  <span class="comment">#输出</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> /bin/bash		         <span class="comment">#运行完毕,进入/bin/bash命令行构建自己的镜像</span></span></span><br></pre></td></tr></table></figure>

<h4 id="构建自己的centos镜像"><a href="#构建自己的centos镜像" class="headerlink" title="构建自己的centos镜像"></a>构建自己的centos镜像</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker build -f mydcoker-centos(DockerFile文件名)  -t mycentos(新构建镜像的名字) .(当前目录下)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@xingzhen dockerfile]# docker images</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED              SIZE</span><br><span class="line">mycentos              latest              8b2b3e8d2370        About a minute ago   295MB</span><br><span class="line">centos                latest              831691599b88        5 weeks ago          215MB</span><br></pre></td></tr></table></figure>

<h4 id="运行自己的centos镜像"><a href="#运行自己的centos镜像" class="headerlink" title="运行自己的centos镜像"></a>运行自己的centos镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen dockerfile]# docker run -it mycentos</span><br><span class="line">[root@80323f6603fb local]# pwd 						#默认工作路径</span><br><span class="line">/usr/local</span><br><span class="line">[root@80323f6603fb local]# ifconfig					#自己构建的镜像ifconfig和vim命令可以执行</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@80323f6603fb local]# vim a</span><br></pre></td></tr></table></figure>

<h4 id="Docker-history"><a href="#Docker-history" class="headerlink" title="Docker history"></a>Docker history</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen dockerfile]<span class="comment"># docker history mycentos #可以查看制作镜像的步骤</span></span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line"><span class="number">8</span>b2b3e8d2370        <span class="number">38</span> minutes ago      /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/sh" "-c" "/bin…   0B                  </span></span><br><span class="line">b7770d835f8a        <span class="number">38</span> minutes ago      /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/sh" "-c" "echo…   0B                  </span></span><br><span class="line">d1c926f9b7ef        <span class="number">38</span> minutes ago      /bin/sh -c <span class="comment">#(nop)  EXPOSE 9003                  0B                  </span></span><br><span class="line"><span class="number">0504</span>f694c360        <span class="number">38</span> minutes ago      /bin/sh -c yum -y install net-tools             <span class="number">22.8</span>MB              </span><br><span class="line">f544ce84b2f3        <span class="number">38</span> minutes ago      /bin/sh -c yum -y install vim                   <span class="number">57.2</span>MB              </span><br><span class="line"><span class="number">713</span>d439a2a77        <span class="number">39</span> minutes ago      /bin/sh -c <span class="comment">#(nop) WORKDIR /usr/local            0B                  </span></span><br><span class="line"><span class="number">07</span>da50b3dbbe        <span class="number">39</span> minutes ago      /bin/sh -c <span class="comment">#(nop)  ENV MYPATH=/usr/local        0B                  </span></span><br><span class="line"><span class="number">148</span>def575014        <span class="number">39</span> minutes ago      /bin/sh -c <span class="comment">#(nop)  MAINTAINER csde&lt;179073546…   0B                  </span></span><br><span class="line"><span class="number">831691599</span>b88        <span class="number">5</span> weeks ago         /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/bash"]            0B                  </span></span><br><span class="line">&lt;missing&gt;           <span class="number">5</span> weeks ago         /bin/sh -c <span class="comment">#(nop)  LABEL org.label-schema.sc…   0B                  </span></span><br><span class="line">&lt;missing&gt;           <span class="number">5</span> weeks ago         /bin/sh -c <span class="comment">#(nop) ADD file:84700c11fcc969ac0…   215MB</span></span><br></pre></td></tr></table></figure>

<h3 id="制作tomcat镜像"><a href="#制作tomcat镜像" class="headerlink" title="制作tomcat镜像"></a>制作tomcat镜像</h3><h4 id="准备镜像文件-tomcat压缩包-jdk压缩包"><a href="#准备镜像文件-tomcat压缩包-jdk压缩包" class="headerlink" title="准备镜像文件,tomcat压缩包,jdk压缩包"></a>准备镜像文件,tomcat压缩包,jdk压缩包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen tomcat]# ls -l</span><br><span class="line">total 201060</span><br><span class="line">-rw-r--r-- 1 root root  11100954 Jul 25 16:43 apache-tomcat-10.0.0-M7.tar.gz</span><br><span class="line">-rw-r--r-- 1 root root 194773928 Jul 25 16:43 jdk-8u231-linux-i586.tar.gz</span><br></pre></td></tr></table></figure>



<h4 id="编写Dockerfile文件"><a href="#编写Dockerfile文件" class="headerlink" title="编写Dockerfile文件"></a>编写Dockerfile文件</h4><p><strong>小提示</strong>:Dockerfile为官方标准命名,构建的时候不需要加-f参数指定文件</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim Dockerfile </span></span><br><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> csdn&lt;<span class="number">1790735465</span>@qq.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> read.txt /usr/lcoal/read.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> jdk-8u231-linux-i586.tar.gz /usr/<span class="built_in">local</span></span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> apache-tomcat-9.0.37 /usr/<span class="built_in">local</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install vim</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/jdk1.<span class="number">8.0</span>_231</span><br><span class="line"><span class="keyword">ENV</span> CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> CATALINA_HOME /usr/local/apache-tomcat-<span class="number">9.0</span>.<span class="number">37</span></span><br><span class="line"><span class="keyword">ENV</span> CATALINA_BASH /usr/local/apache-tomcat-<span class="number">9.0</span>.<span class="number">37</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> PATH $PATH:$JAVA_HOME/bin:$CLTALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span>  <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> /usr/<span class="built_in">local</span>/apache-tomcat-9.0.37/bin/startup.sh &amp;&amp; tail -F /usr/<span class="built_in">local</span>/apache-tomcat-9.0.37/bin/logs/catalina.out</span></span><br></pre></td></tr></table></figure>

<h4 id="构建自己的tomcat镜像"><a href="#构建自己的tomcat镜像" class="headerlink" title="构建自己的tomcat镜像"></a>构建自己的tomcat镜像</h4><p>[root@xingzhen tomcat]# docker build -t dockerfiletomcat  .</p>
<h4 id="运行自己的tomcat镜像"><a href="#运行自己的tomcat镜像" class="headerlink" title="运行自己的tomcat镜像"></a>运行自己的tomcat镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 9001:8080 --name csdeistomcat -v /home/tomcat/text:/usr/local/apache-tomcat-9.0.37/webapps/text -v /home/tomcat/logs:/usr/local/apache-tomcat-9.0.37/logs  dockerfiletomcat  /bin/bash</span><br></pre></td></tr></table></figure>

<h1 id="Docker网络"><a href="#Docker网络" class="headerlink" title="Docker网络"></a>Docker网络</h1><h2 id="Docker0"><a href="#Docker0" class="headerlink" title="Docker0"></a>Docker0</h2><p><strong>docker的网络为docker0</strong> </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen ~]# ip addr 查看本地ip </span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:00:0a:a3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.26.159.240/20 brd 172.26.159.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 315246334sec preferred_lft 315246334sec</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:63:8a:85:a6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>分析可得，本机有三个网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lo 127.0.0.1 # 本机回环地址 </span><br><span class="line">eth0 172.17.90.138 # 阿里云的私有IP </span><br><span class="line">docker0 172.18.0.1 # docker网桥</span><br></pre></td></tr></table></figure>

<h2 id="服务器是否可以ping通里面的容器"><a href="#服务器是否可以ping通里面的容器" class="headerlink" title="服务器是否可以ping通里面的容器"></a>服务器是否可以ping通里面的容器</h2><p>运行tomcat镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen ~]# docker run -d -P --name tomcat01 tomcat	#运行tomcat镜像</span><br><span class="line">Unable to find image 'tomcat:latest' locally</span><br><span class="line">latest: Pulling from library/tomcat</span><br><span class="line">31dd5ebca5ef: Pull complete </span><br><span class="line">3ed641c4ae98: Pull complete </span><br><span class="line">bcd57146431e: Pull complete </span><br><span class="line">ac34a4d7c330: Pull complete </span><br><span class="line">d29274a3f575: Pull complete </span><br><span class="line">f21ec44b2df0: Pull complete </span><br><span class="line">ff3ea40e02df: Pull complete </span><br><span class="line">d672d3eaa583: Pull complete </span><br><span class="line">c3116cc6d058: Pull complete </span><br><span class="line">cc6b3931e08c: Pull complete </span><br><span class="line">Digest: sha256:acf4e40b918af485753d4e6d219b04efedccc99a821526b5dda91a467008a659</span><br><span class="line">Status: Downloaded newer image for tomcat:latest</span><br><span class="line">363ba35b1330e46538d54632d07358e76a06f1826e7b3d8018bb775e5cc2cac8</span><br><span class="line"></span><br><span class="line">[root@xingzhen ~]# ip addr		#每运行一个容器,就会多了一个Docker0的网卡</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:00:0a:a3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.26.159.240/20 brd 172.26.159.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 315246110sec preferred_lft 315246110sec</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:63:8a:85:a6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">63: vethea533a5@if62: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether ae:ef:26:cc:57:a6 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    </span><br><span class="line">[root@xingzhen ~]# docker exec -it tomcat01 ip addr进入容器,查看当前容器的ip</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">62: eth0@if63: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@xingzhen ~]# ping 172.17.0.2		#通过本地ping容器内的ip,发现可以ping通,连通成功</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.082 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.067 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.064 ms</span><br></pre></td></tr></table></figure>

<h2 id="容器之间是否可以ping通"><a href="#容器之间是否可以ping通" class="headerlink" title="容器之间是否可以ping通"></a>容器之间是否可以ping通</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen ~]# docker run -d --name tomcat02 tomcat	 运行tomcat02</span><br><span class="line">da3b1a2334c8e29bc02e311ea6dce421d38efd6516d10a215c698d0e85e0be6e</span><br><span class="line">[root@xingzhen ~]# docker run -it tomcat02 ping 172.17.0.2	发现tomcat02可以ping通tomcat01</span><br><span class="line">Unable to find image 'tomcat02:latest' locally</span><br><span class="line">^C</span><br><span class="line">[root@xingzhen ~]# docker exec  -it tomcat02 ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.098 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.095 ms</span><br><span class="line">^C</span><br><span class="line">--- 172.17.0.2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 999ms</span><br><span class="line">rtt min/avg/max/mdev = 0.095/0.096/0.098/0.009 ms</span><br></pre></td></tr></table></figure>

<p><strong>结论：tomcat1和tomcat2共用一个路由器。是的，他们使用的一个，就是docker0。任何一个容器启动</strong> </p>
<p><strong>默认都是docker0网络。</strong> </p>
<p><strong>docker默认会给容器分配一个可用ip。</strong></p>
<h2 id="发现问题"><a href="#发现问题" class="headerlink" title="发现问题"></a>发现问题</h2><p><strong>每次启动容器,docker0都会随机分配一个ip,如果服务崩溃了,我们再次重启docker,就会发现问题,ip地址发生变化,此时,即使服务启动成功,也是不可用的。我们可不可以通过镜像的名字进行连接呢?</strong></p>
<h2 id="–link"><a href="#–link" class="headerlink" title="–link"></a>–link</h2><p>出现以上问题,我们就可以通过–link参数进行解决</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen ~]# docker exec -it tomcat02 ping tomcat01	</span><br><span class="line">ping: tomcat01: Name or service not known	#发现ping不通</span><br><span class="line"></span><br><span class="line">[root@xingzhen ~]# docker run -d -P --name tomcat03 --link tomcat02 tomcat #运行一个tomca03和tomcat02进行链接,在ping测试</span><br><span class="line">15def733ed76baf89dc3dbd9d01e153f53f47ae6162d3f4d4fa6a3c28face057</span><br><span class="line"></span><br><span class="line">[root@xingzhen ~]# docker exec -it tomcat03 ping tomcat02 #可以ping通</span><br><span class="line">PING tomcat02 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.100 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.072 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@xingzhen ~]# docker exec -it tomcat02 ping tomcat03 </span><br><span class="line">ping: tomcat03: Name or service not known</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">tomcat02pingtomcat03无法ping通,只能单向操作</span></span><br></pre></td></tr></table></figure>

<p>思考，这个原理是什么呢？我们进入tomcat03中查看下host配置文件.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen ~]# docker exec -it tomcat03 cat /etc/hosts </span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	tomcat02 da3b1a2334c8  # 发现tomcat2直接被写在这里</span><br><span class="line">172.17.0.4	15def733ed76</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 所以这里其实就是配置了一个 hosts 地址而已！ </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 原因：--link的时候，直接把需要link的主机的域名和ip直接配置到了hosts文件中了。</span></span><br></pre></td></tr></table></figure>

<p>–link早都过时了，我们不推荐使用！我们可以使用自定义网络的方式</p>
<h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h2><h3 id="网络的基本命令查看"><a href="#网络的基本命令查看" class="headerlink" title="网络的基本命令查看"></a>网络的基本命令查看</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen ~]# docker network --help</span><br><span class="line"></span><br><span class="line">Usage:	docker network COMMAND</span><br><span class="line"></span><br><span class="line">Manage networks</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  connect     Connect a container to a network	#将容器连接到网络</span><br><span class="line">  create      Create a network					#创建一个网络 </span><br><span class="line">  disconnect  Disconnect a container from a network	#从网络上断开容器</span><br><span class="line">  inspect     Display detailed information on one or more networks #查看网络的元数据</span><br><span class="line">  ls          List networks     			#列出所有的网络</span><br><span class="line">  prune       Remove all unused networks	#删除所有未使用的网络</span><br><span class="line">  rm          Remove one or more networks	#删除一个或多个网络	</span><br><span class="line"></span><br><span class="line">Run 'docker network COMMAND --help' for more information on a command.</span><br></pre></td></tr></table></figure>

<h3 id="查看所有的网络"><a href="#查看所有的网络" class="headerlink" title="查看所有的网络"></a>查看所有的网络</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">51f9a780e8f6        bridge              bridge              local</span><br><span class="line">63725297c5ed        host                host                local</span><br><span class="line">a976950c2bf9        none                null                local</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">bridge桥接   --net=bridge  默认值</span></span><br><span class="line"><span class="meta">#</span><span class="bash">none		--net=none	   不配置网络</span></span><br><span class="line"><span class="meta">#</span><span class="bash">host		--net=host	   和宿主机共享网络</span></span><br></pre></td></tr></table></figure>

<h3 id="创建一个网络"><a href="#创建一个网络" class="headerlink" title="创建一个网络"></a>创建一个网络</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen ~]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynetwork	#创建一个名字为mynetwork的网络</span><br><span class="line">9319d9d1da6764ec8bfc8cfce35043a17db522e4215314bae8a6aad01af6beb1</span><br><span class="line"></span><br><span class="line">[root@xingzhen ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">51f9a780e8f6        bridge              bridge              local</span><br><span class="line">63725297c5ed        host                host                local</span><br><span class="line">9319d9d1da67        mynetwork           bridge              local #创建成功</span><br><span class="line">a976950c2bf9        none                null                local </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@xingzhen ~]# docker network inspect mynetwork 查看创建网络的元数据</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Name": "mynetwork",</span><br><span class="line">        "Id": "9319d9d1da6764ec8bfc8cfce35043a17db522e4215314bae8a6aad01af6beb1",</span><br><span class="line">        "Created": "2020-07-29T20:07:18.338239296+08:00",</span><br><span class="line">        "Scope": "local",</span><br><span class="line">        "Driver": "bridge",</span><br><span class="line">        "EnableIPv6": false,</span><br><span class="line">        "IPAM": &#123;</span><br><span class="line">            "Driver": "default",</span><br><span class="line">            "Options": &#123;&#125;,</span><br><span class="line">            "Config": [</span><br><span class="line">                &#123;</span><br><span class="line">                    "Subnet": "192.168.0.0/16",</span><br><span class="line">                    "Gateway": "192.168.0.1"</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "Internal": false,</span><br><span class="line">        "Attachable": false,</span><br><span class="line">        "Ingress": false,</span><br><span class="line">        "ConfigFrom": &#123;</span><br><span class="line">            "Network": ""</span><br><span class="line">        &#125;,</span><br><span class="line">        "ConfigOnly": false,</span><br><span class="line">        "Containers": &#123;&#125;,</span><br><span class="line">        "Options": &#123;&#125;,</span><br><span class="line">        "Labels": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="自定义网络的好处"><a href="#自定义网络的好处" class="headerlink" title="自定义网络的好处"></a>自定义网络的好处</h3><p>我们来启动两个容器测试，使用自己的 mynetwork！ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen ~]# docker run -d -P --name tomcat-mynetwork-01 --net mynetwork   tomcat</span><br><span class="line">Unable to find image 'tomcat:latest' locally</span><br><span class="line">latest: Pulling from library/tomcat</span><br><span class="line">31dd5ebca5ef: Pull complete </span><br><span class="line">3ed641c4ae98: Pull complete </span><br><span class="line">bcd57146431e: Pull complete </span><br><span class="line">ac34a4d7c330: Pull complete </span><br><span class="line">d29274a3f575: Pull complete </span><br><span class="line">f21ec44b2df0: Pull complete </span><br><span class="line">ff3ea40e02df: Pull complete </span><br><span class="line">d672d3eaa583: Pull complete </span><br><span class="line">c3116cc6d058: Pull complete </span><br><span class="line">cc6b3931e08c: Pull complete </span><br><span class="line">Digest: sha256:acf4e40b918af485753d4e6d219b04efedccc99a821526b5dda91a467008a659</span><br><span class="line">Status: Downloaded newer image for tomcat:latest</span><br><span class="line">696e580c05f5bc5b0b8ee35181ce5c60ba0300826a8f02e6293062e747e5ccff</span><br><span class="line"></span><br><span class="line">[root@xingzhen ~]# docker run -d -P --name tomcat-mynetwork-02 --net mynetwork   tomcat</span><br><span class="line">fd53b84cbb0275cb166d5dd0001daee7d387e1918d31969b61525693c2f918d5</span><br><span class="line"></span><br><span class="line">[root@xingzhen ~]# docker network inspect mynetwork</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Name": "mynetwork",</span><br><span class="line">        "Id": "9319d9d1da6764ec8bfc8cfce35043a17db522e4215314bae8a6aad01af6beb1",</span><br><span class="line">        "Created": "2020-07-29T20:07:18.338239296+08:00",</span><br><span class="line">        "Scope": "local",</span><br><span class="line">        "Driver": "bridge",</span><br><span class="line">        "EnableIPv6": false,</span><br><span class="line">        "IPAM": &#123;</span><br><span class="line">            "Driver": "default",</span><br><span class="line">            "Options": &#123;&#125;,</span><br><span class="line">            "Config": [</span><br><span class="line">                &#123;</span><br><span class="line">                    "Subnet": "192.168.0.0/16",</span><br><span class="line">                    "Gateway": "192.168.0.1"</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "Internal": false,</span><br><span class="line">        "Attachable": false,</span><br><span class="line">        "Ingress": false,</span><br><span class="line">        "ConfigFrom": &#123;</span><br><span class="line">            "Network": ""</span><br><span class="line">        &#125;,</span><br><span class="line">        "ConfigOnly": false,</span><br><span class="line">        "Containers": &#123;</span><br><span class="line">            "696e580c05f5bc5b0b8ee35181ce5c60ba0300826a8f02e6293062e747e5ccff": &#123;</span><br><span class="line">                "Name": "tomcat-mynetwork-01",		#容器tomcat-mynetwork-01到网络配置里面</span><br><span class="line">                "EndpointID": "03ea77d22ea84ac589060d593bac9261594cdca50d79d6a976231ef42f6b0f08",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:02",</span><br><span class="line">                "IPv4Address": "192.168.0.2/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            "fd53b84cbb0275cb166d5dd0001daee7d387e1918d31969b61525693c2f918d5": &#123;</span><br><span class="line">                "Name": "tomcat-mynetwork-02", #容器tomcat-mynetwork-02到网络配置里面</span><br><span class="line">                "EndpointID": "a8b5b6e06cce93f3bbf36a429d1fcf673300b599a87d0c2b21a7b097672d1ba9",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:03",</span><br><span class="line">                "IPv4Address": "192.168.0.3/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "Options": &#123;&#125;,</span><br><span class="line">        "Labels": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">可以发现我们不加--link参数,也可以通过容器名字进行连通</span></span><br><span class="line">[root@xingzhen ~]# docker exec -it tomcat-mynetwork-01 ping tomcat-mynetwork-02</span><br><span class="line">PING tomcat-mynetwork-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-mynetwork-02.mynetwork (192.168.0.3): icmp_seq=1 ttl=64 time=0.071 ms</span><br><span class="line">64 bytes from tomcat-mynetwork-02.mynetwork (192.168.0.3): icmp_seq=2 ttl=64 time=0.071 ms</span><br></pre></td></tr></table></figure>

<h2 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h2><p><img src="https://cdn.jsdelivr.net/gh/1790735465/butterfly_image/img/20200729201708.png" alt></p>
<p><img src="https://cdn.jsdelivr.net/gh/1790735465/butterfly_image/img/20200729202153.png" alt></p>
<p>那关键的问题来了，如何让 tomcat-mynetwork-01 访问 tomcat01？ </p>
<h3 id="启动2个默认网络的容器"><a href="#启动2个默认网络的容器" class="headerlink" title="启动2个默认网络的容器"></a>启动2个默认网络的容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen ~]# docker run -d  -P --name tomcat01 tomcat</span><br><span class="line">41bf9ceb846838c69ffeb86a75a60ef1eea710b1be1a998ed82f4b8a07c12271</span><br><span class="line">[root@xingzhen ~]# docker run -d  -P --name tomcat02 tomcat</span><br><span class="line">337ccfae9770db77dff6653e136ff77c8bbe9ec6b4bfa1bf1b34ee36917048ee</span><br></pre></td></tr></table></figure>

<h3 id="将容器连接到网络"><a href="#将容器连接到网络" class="headerlink" title="将容器连接到网络"></a>将容器连接到网络</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen ~]# docker network connect mynetwork tomcat01 #将容器tomcat01连接到网络mynetwork</span><br><span class="line">[root@xingzhen ~]#  docker network inspect mynetwork		#查看网络mynetwork的元数据</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Name": "mynetwork",</span><br><span class="line">        "Id": "9319d9d1da6764ec8bfc8cfce35043a17db522e4215314bae8a6aad01af6beb1",</span><br><span class="line">        "Created": "2020-07-29T20:07:18.338239296+08:00",</span><br><span class="line">        "Scope": "local",</span><br><span class="line">        "Driver": "bridge",</span><br><span class="line">        "EnableIPv6": false,</span><br><span class="line">        "IPAM": &#123;</span><br><span class="line">            "Driver": "default",</span><br><span class="line">            "Options": &#123;&#125;,</span><br><span class="line">            "Config": [</span><br><span class="line">                &#123;</span><br><span class="line">                    "Subnet": "192.168.0.0/16",</span><br><span class="line">                    "Gateway": "192.168.0.1"</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "Internal": false,</span><br><span class="line">        "Attachable": false,</span><br><span class="line">        "Ingress": false,</span><br><span class="line">        "ConfigFrom": &#123;</span><br><span class="line">            "Network": ""</span><br><span class="line">        &#125;,</span><br><span class="line">        "ConfigOnly": false,</span><br><span class="line">        "Containers": &#123;</span><br><span class="line">            "41bf9ceb846838c69ffeb86a75a60ef1eea710b1be1a998ed82f4b8a07c12271": &#123;</span><br><span class="line">                "Name": "tomcat01",		#容器tomcat01已经到了mynetwork网络配置里面</span><br><span class="line">                "EndpointID": "8540237b1f98c7dbb7b52c5401405f9f1e163fe0709cb7832ea06ca1616b23c4",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:04",</span><br><span class="line">                "IPv4Address": "192.168.0.4/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            "696e580c05f5bc5b0b8ee35181ce5c60ba0300826a8f02e6293062e747e5ccff": &#123;</span><br><span class="line">                "Name": "tomcat-mynetwork-01",</span><br><span class="line">                "EndpointID": "03ea77d22ea84ac589060d593bac9261594cdca50d79d6a976231ef42f6b0f08",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:02",</span><br><span class="line">                "IPv4Address": "192.168.0.2/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            "fd53b84cbb0275cb166d5dd0001daee7d387e1918d31969b61525693c2f918d5": &#123;</span><br><span class="line">                "Name": "tomcat-mynetwork-02",</span><br><span class="line">                "EndpointID": "a8b5b6e06cce93f3bbf36a429d1fcf673300b599a87d0c2b21a7b097672d1ba9",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:03",</span><br><span class="line">                "IPv4Address": "192.168.0.3/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "Options": &#123;&#125;,</span><br><span class="line">        "Labels": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">[root@xingzhen ~]#  docker exec -it tomcat01 ping tomcat-mynetwork-01  tomcat01 可以ping通</span><br><span class="line">PING tomcat-mynetwork-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-mynetwork-01.mynetwork (192.168.0.2): icmp_seq=1 ttl=64 time=0.080 ms</span><br><span class="line">64 bytes from tomcat-mynetwork-01.mynetwork (192.168.0.2): icmp_seq=2 ttl=64 time=0.076 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@xingzhen ~]# docker exec -it tomcat02 ping tomcat-mynetwork-01 </span><br><span class="line"><span class="meta">#</span><span class="bash">tomcat02 依旧ping不通，大家应该就理解了</span></span><br><span class="line">ping: tomcat-mynetwork-01: Name or service not known</span><br></pre></td></tr></table></figure>

<p><strong>结论：如果要跨网络操作别人，就需要使用 docker network connect [OPTIONS] NETWORK</strong> </p>
<p><strong>CONTAINER 连接</strong> </p>
<h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><h2 id="部署一个redis集群"><a href="#部署一个redis集群" class="headerlink" title="部署一个redis集群"></a>部署一个redis集群</h2><h3 id="创建redis自己的网络"><a href="#创建redis自己的网络" class="headerlink" title="创建redis自己的网络"></a>创建redis自己的网络</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen /]# docker network create redis --subnet 172.38.0.0/16</span><br><span class="line">d6173dc7217fb5b7e16fa5a44acfa075f4994bea757eb27742b588808472406c</span><br></pre></td></tr></table></figure>

<h3 id="通过脚本创建六个redis配置"><a href="#通过脚本创建六个redis配置" class="headerlink" title="通过脚本创建六个redis配置"></a>通过脚本创建六个redis配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen /]for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;/mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379 </span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">[root@xingzhen /]# cd /mydata</span><br><span class="line">[root@xingzhen mydata]# ls</span><br><span class="line">redis</span><br><span class="line">[root@xingzhen mydata]# cd redis/</span><br><span class="line">[root@xingzhen redis]# ls</span><br><span class="line">node-1  node-2  node-3  node-4  node-5  node-6</span><br><span class="line">[root@xingzhen redis]# cd node-1/</span><br><span class="line">[root@xingzhen node-1]# ls</span><br><span class="line">conf</span><br><span class="line">[root@xingzhen node-1]# cd conf/</span><br><span class="line">[root@xingzhen conf]# ls</span><br><span class="line">redis.conf</span><br><span class="line">[root@xingzhen conf]# cat redis.conf </span><br><span class="line">port 6379 </span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.11</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<h3 id="启动6个redis容器"><a href="#启动6个redis容器" class="headerlink" title="启动6个redis容器"></a>启动6个redis容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">启动第1个容器</span></span><br><span class="line">docker run -p 6371:6379 -p 16371:16379 --name redis-1 -v /mydata/redis/node-1/data:/data -v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">启动第2个容器</span></span><br><span class="line">docker run -p 6372:6379 -p 16372:16379 --name redis-2 -v /mydata/redis/node-2/data:/data -v /mydata/redis/node-2/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">启动第3个容器</span></span><br><span class="line">docker run -p 6373:6379 -p 16373:16379 --name redis-3 -v /mydata/redis/node-3/data:/data -v /mydata/redis/node-3/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.13 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">启动第4个容器</span></span><br><span class="line">docker run -p 6374:6379 -p 16374:16379 --name redis-4 -v /mydata/redis/node-4/data:/data -v /mydata/redis/node-4/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.14 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">启动第5个容器</span></span><br><span class="line">docker run -p 6375:6379 -p 16375:16379 --name redis-5 -v /mydata/redis/node-5/data:/data -v /mydata/redis/node-5/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.15 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">启动第6个容器</span></span><br><span class="line">docker run -p 6376:6379 -p 16376:16379 --name redis-6 -v /mydata/redis/node-6/data:/data -v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">6个容器启动完毕</span></span><br><span class="line">[root@xingzhen /]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                    COMMAND                  CREATED             STATUS              PORTS                                              NAMES</span><br><span class="line">6f47a758e203        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   6 seconds ago       Up 5 seconds        0.0.0.0:6376-&gt;6379/tcp, 0.0.0.0:16376-&gt;16379/tcp   redis-6</span><br><span class="line">50caa9154a95        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   11 seconds ago      Up 10 seconds       0.0.0.0:6375-&gt;6379/tcp, 0.0.0.0:16375-&gt;16379/tcp   redis-5</span><br><span class="line">1f7424664193        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   23 seconds ago      Up 22 seconds       0.0.0.0:6374-&gt;6379/tcp, 0.0.0.0:16374-&gt;16379/tcp   redis-4</span><br><span class="line">5879e29c08d9        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   37 seconds ago      Up 36 seconds       0.0.0.0:6373-&gt;6379/tcp, 0.0.0.0:16373-&gt;16379/tcp   redis-3</span><br><span class="line">8848bee897ad        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   52 seconds ago      Up 51 seconds       0.0.0.0:6372-&gt;6379/tcp, 0.0.0.0:16372-&gt;16379/tcp   redis-2</span><br><span class="line">31c94253015a        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   3 minutes ago       Up 3 minutes        0.0.0.0:6371-&gt;6379/tcp, 0.0.0.0:16371-&gt;16379/tcp   redis-1</span><br><span class="line"><span class="meta">#</span><span class="bash">如果命令太麻烦,可以用shell启动多个容器</span></span><br><span class="line">[root@xingzhen /]docker run -p 637$&#123;port&#125;:6379 -p 1637$&#123;port&#125;:16379 --name redis-$&#123;port&#125; -v /mydata/redis/node-$&#123;port&#125;/data:/data </span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf </span><br><span class="line">-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br></pre></td></tr></table></figure>

<h3 id="创建集群"><a href="#创建集群" class="headerlink" title="创建集群"></a>创建集群</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">进入一个redis，注意这里是sh命令，bash在redis里面没有</span></span><br><span class="line">[root@xingzhen /]# docker exec -it redis-1 /bin/sh</span><br><span class="line">/data # </span><br><span class="line"><span class="meta">#</span><span class="bash">创建集群</span></span><br><span class="line">/data # redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379  172.38.0.13:6379 172.38.0.14:6379 172.38.0.</span><br><span class="line">15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 172.38.0.15:6379 to 172.38.0.11:6379</span><br><span class="line">Adding replica 172.38.0.16:6379 to 172.38.0.12:6379</span><br><span class="line">Adding replica 172.38.0.14:6379 to 172.38.0.13:6379</span><br><span class="line">M: 1b93874cadd771289a15e4764d858812db410e41 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: 1400ff9f7f40242c96ee8bc4e896ae3b41523c16 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 5a3a41b5619618426f729c98664b81296ec5bca1 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: a9d621e71a8ab1032176ea8d0becf269ff85d46c 172.38.0.14:6379</span><br><span class="line">   replicates 5a3a41b5619618426f729c98664b81296ec5bca1</span><br><span class="line">S: 6b6cbaab864ea00467261045382e02d0ce9dbe6b 172.38.0.15:6379</span><br><span class="line">   replicates 1b93874cadd771289a15e4764d858812db410e41</span><br><span class="line">S: 4031830ca9054b78faebac2e0c0494882273f144 172.38.0.16:6379</span><br><span class="line">   replicates 1400ff9f7f40242c96ee8bc4e896ae3b41523c16</span><br><span class="line">Can I set the above configuration? (type 'yes' to accept): yes</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Nodes configuration updated</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Performing Cluster Check (using node 172.38.0.11:6379)</span></span><br><span class="line">M: 1b93874cadd771289a15e4764d858812db410e41 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 5a3a41b5619618426f729c98664b81296ec5bca1 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 4031830ca9054b78faebac2e0c0494882273f144 172.38.0.16:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 1400ff9f7f40242c96ee8bc4e896ae3b41523c16</span><br><span class="line">S: a9d621e71a8ab1032176ea8d0becf269ff85d46c 172.38.0.14:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 5a3a41b5619618426f729c98664b81296ec5bca1</span><br><span class="line">M: 1400ff9f7f40242c96ee8bc4e896ae3b41523c16 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 6b6cbaab864ea00467261045382e02d0ce9dbe6b 172.38.0.15:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 1b93874cadd771289a15e4764d858812db410e41</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.   #集群创建完成</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 连接集群</span></span><br><span class="line">/data # redis-cli -c</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看集群信息</span></span><br><span class="line">127.0.0.1:6379&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:598</span><br><span class="line">cluster_stats_messages_pong_sent:566</span><br><span class="line">cluster_stats_messages_sent:1164</span><br><span class="line">cluster_stats_messages_ping_received:561</span><br><span class="line">cluster_stats_messages_pong_received:598</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:1164</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看节点</span></span><br><span class="line">127.0.0.1:6379&gt; cluster nodes</span><br><span class="line">5a3a41b5619618426f729c98664b81296ec5bca1 172.38.0.13:6379@16379 master - 0 1596073717559 3 connected 10923-16383</span><br><span class="line">4031830ca9054b78faebac2e0c0494882273f144 172.38.0.16:6379@16379 slave 1400ff9f7f40242c96ee8bc4e896ae3b41523c16 0 1596073718000 6 connected</span><br><span class="line">a9d621e71a8ab1032176ea8d0becf269ff85d46c 172.38.0.14:6379@16379 slave 5a3a41b5619618426f729c98664b81296ec5bca1 0 1596073717559 4 connected</span><br><span class="line">1b93874cadd771289a15e4764d858812db410e41 172.38.0.11:6379@16379 myself,master - 0 1596073716000 1 connected 0-5460</span><br><span class="line">1400ff9f7f40242c96ee8bc4e896ae3b41523c16 172.38.0.12:6379@16379 master - 0 1596073718361 2 connected 5461-10922</span><br><span class="line">6b6cbaab864ea00467261045382e02d0ce9dbe6b 172.38.0.15:6379@16379 slave 1b93874cadd771289a15e4764d858812db410e41 0 1596073717360 5 connected</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">127.0.0.1:6379&gt; set a b			#赋值</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> Redirected to slot [15495] located at 172.38.0.13:6379	<span class="comment">#处理的为redis-3</span></span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@xingzhen ~]# docker stop redis-3		#停止掉redis-3容器</span><br><span class="line">redis-3</span><br><span class="line">[root@xingzhen ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                    COMMAND                  CREATED             STATUS              PORTS                                              NAMES</span><br><span class="line">6f47a758e203        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   25 minutes ago      Up 25 minutes       0.0.0.0:6376-&gt;6379/tcp, 0.0.0.0:16376-&gt;16379/tcp   redis-6</span><br><span class="line">50caa9154a95        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   25 minutes ago      Up 25 minutes       0.0.0.0:6375-&gt;6379/tcp, 0.0.0.0:16375-&gt;16379/tcp   redis-5</span><br><span class="line">1f7424664193        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   25 minutes ago      Up 25 minutes       0.0.0.0:6374-&gt;6379/tcp, 0.0.0.0:16374-&gt;16379/tcp   redis-4</span><br><span class="line">8848bee897ad        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   25 minutes ago      Up 25 minutes       0.0.0.0:6372-&gt;6379/tcp, 0.0.0.0:16372-&gt;16379/tcp   redis-2</span><br><span class="line">31c94253015a        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   28 minutes ago      Up 28 minutes       0.0.0.0:6371-&gt;6379/tcp, 0.0.0.0:16371-&gt;16379/tcp   redis-1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; get a		#依然可以拿到a的值</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash"> Redirected to slot [15495] located at 172.38.0.14:6379</span></span><br><span class="line">"b"</span><br></pre></td></tr></table></figure>

<h2 id="Springboot项目打包发布"><a href="#Springboot项目打包发布" class="headerlink" title="Springboot项目打包发布"></a>Springboot项目打包发布</h2><p><strong>创建Springboot项目,就不写了,本地项目测试成功.</strong></p>
<h3 id="编写Dockerfile文件-1"><a href="#编写Dockerfile文件-1" class="headerlink" title="编写Dockerfile文件"></a>编写Dockerfile文件</h3><p><img src="/posts/1736621668/a.png" alt></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span>	</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> *.jar  /app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"--server.port=8080"</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"java"</span>,<span class="string">"-jar"</span>,<span class="string">"/app.jar"</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="项目打包"><a href="#项目打包" class="headerlink" title="项目打包"></a>项目打包</h3><p><img src="/posts/1736621668/b.png" alt></p>
<p><strong>上传到服务器,省率</strong></p>
<h3 id="构建容器"><a href="#构建容器" class="headerlink" title="构建容器"></a>构建容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen dockerspringboot]# ls</span><br><span class="line">dockerdemo-0.0.1-SNAPSHOT.jar  Dockerfile</span><br><span class="line">[root@xingzhen dockerspringboot]# cat Dockerfile </span><br><span class="line">FROM java:8</span><br><span class="line"></span><br><span class="line">COPY *.jar  /app.jar</span><br><span class="line"></span><br><span class="line">CMD ["--server.port=8080"]</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">ENTRYPOINT ["java","-jar","/app.jar"]</span><br><span class="line">[root@xingzhen dockerspringboot]# docker build -t myspringboot .</span><br><span class="line">Sending build context to Docker daemon  18.02MB</span><br><span class="line">Step 1/5 : FROM java:8</span><br><span class="line">8: Pulling from library/java</span><br><span class="line">5040bd298390: Pull complete </span><br><span class="line">fce5728aad85: Pull complete </span><br><span class="line">76610ec20bf5: Pull complete </span><br><span class="line">60170fec2151: Pull complete </span><br><span class="line">e98f73de8f0d: Pull complete </span><br><span class="line">11f7af24ed9c: Pull complete </span><br><span class="line">49e2d6393f32: Pull complete </span><br><span class="line">bb9cdec9c7f3: Pull complete </span><br><span class="line">Digest: sha256:c1ff613e8ba25833d2e1940da0940c3824f03f802c449f3d1815a66b7f8c0e9d</span><br><span class="line">Status: Downloaded newer image for java:8</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> d23bdf5b1b1b</span></span><br><span class="line">Step 2/5 : COPY *.jar  /app.jar</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> cc1ec406a31f</span></span><br><span class="line">Step 3/5 : CMD ["--server.port=8080"]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 37acddbde5a5</span></span><br><span class="line">Removing intermediate container 37acddbde5a5</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 0bb8dc261568</span></span><br><span class="line">Step 4/5 : EXPOSE 8080</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 4450d9ebfdf5</span></span><br><span class="line">Removing intermediate container 4450d9ebfdf5</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> dd8878f0ad1a</span></span><br><span class="line">Step 5/5 : ENTRYPOINT ["java","-jar","/app.jar"]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> ab8cd45b8157</span></span><br><span class="line">Removing intermediate container ab8cd45b8157</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 232d1e725442</span></span><br><span class="line">Successfully built 232d1e725442</span><br><span class="line">Successfully tagged myspringboot:latest</span><br><span class="line"></span><br><span class="line">[root@xingzhen dockerspringboot]# docker images #容器构建成功</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">myspringboot        latest              232d1e725442        9 seconds ago       661MB</span><br><span class="line">java                8                   d23bdf5b1b1b        3 years ago         643MB</span><br></pre></td></tr></table></figure>

<h3 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xingzhen dockerspringboot]# docker run -d -p 80:8080 myspringboot</span><br><span class="line">6b38e0bd0dcfe26d0d1695c008e6e2303c5b41ddd934567349579f26cfb4f731</span><br></pre></td></tr></table></figure>

<h3 id="访问测试"><a href="#访问测试" class="headerlink" title="访问测试"></a>访问测试</h3><p><img src="/posts/1736621668/c.png" alt></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">csde`Blog</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.csde.vip/posts/1736621668/">https://www.csde.vip/posts/1736621668/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.csde.vip" target="_blank">csde`Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/posts/322094917/"><img class="prev_cover" src="https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1809522521,2258770536&amp;fm=26&amp;gp=0.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">POI及EasyExcel学习</div></div></a></div><div class="next-post pull_right"><a href="/posts/1565438925/"><img class="next_cover" src="https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=4135708617,3847637319&amp;fm=26&amp;gp=0.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Centos安装Dokcer</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'昵称,邮箱,主页')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')
let friends = 'ce2266d4e91782573b50c29e06a811e4'.split(',')
let master = 'd799cdaab02b754cb52617372d860835'.split(',')

window.valine = new Valine({
  el:'#vcomment',
  appId: '8FuNpxJtbdHtuhJ3GKoCfTWh-gzGzoHsz',
  appKey: 'UhJiKPdHOOIQ9G7Duuj2l7br',
  notify: false,
  verify: false,
  placeholder: '请不要说脏话哦！',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-cn',
  recordIP: true,
  serverURLs: '',
  emojiCDN: '//i0.hdslb.com/bfs/emote/',
  emojiMaps: {"2020":"dc709fac0d361370bcf0d36d32adb97df7c95824.png","tv_白眼":"c1d59f439e379ee50eef488bcb5e5378e5044ea4.png","tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_坏笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_难过":"87f46748d3f142ebc6586ff58860d0e2fc8263ba.png","tv_生气":"26702dcafdab5e8225b43ffd23c94ac1ff932654.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_斜眼笑":"911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_发怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_惊吓":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png","tv_呕吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_疑问":"0793d949b18d7be716078349c202c15ff166f314.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_鼓掌":"1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png","tv_抠鼻":"c666f55e88d471e51bbd9fab9bb308110824a6eb.png","tv_亲亲":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_调皮":"b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png","tv_笑哭":"1abc628f6d4f4caf9d0e7800878f4697abbc8273.png","tv_晕":"5443c22b4d07fb1907ccc610c8e6db254f2461b7.png","tv_点赞":"f85c354995bd99e28fc76c869bfe42ba6438eff4.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_睡着":"8b196675b53af58264f383c50ad0945048290b33.png","tv_色":"61822c7e9aae5da76475e7892534545336b23a6f.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_无奈":"ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png","tv_再见":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_流汗":"cead1c351ab8d79e9f369605beb90148db0fbed3.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_抓狂":"fe31c08edad661d63762b04e17b8d5ae3c71a757.png","tv_黑人问号":"45821a01f51bc867da9edbaa2e070410819a95b2.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_打脸":"56ab10b624063e966bfcb76ea5dc4794d87dfd47.png","tv_闭嘴":"c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png","tv_鄙视":"6e72339f346a692a495b123174b49e4e8e781303.png","tv_腼腆":"89712c0d4af73e67f89e35cbc518420380a7f6f4.png","tv_馋":"fc7e829b845c43c623c8b490ee3602b7f0e76a31.png","tv_可爱":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_发财":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_生病":"8b0ec90e6b86771092a498c54f09fc94621c1900.png","tv_流鼻血":"c32d39db2737f89b904ca32700d140a9241b0767.png","tv_尴尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_流泪":"7e71cde7858f0cd50d74b0264aa26db612a8a167.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_皱眉":"72ccad6679fea0d14cce648b4d818e09b8ffea2d.png","tv_鬼脸":"0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png","tv_调侃":"4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png","tv_目瞪口呆":"0b8cb81a68de5d5365212c99375e7ace3e7891b7.png","2233娘_大笑":"16b8794be990cefa6caeba4d901b934a227ee3b8.png","2233娘_疑问":"0b41f509351958dbb63d472fec0132d1bd03bd14.png","2233娘_吃惊":"d1628c43d35b1530c0504a643ff80b6189fa0a43.png","2233娘_汗":"247cd9df8cdf84b18368c21e3b2dd374e84c0927.png","2233娘_大哭":"476a2a60f6e337b8c0697a592e0aa82781f6b33b.png","2233娘_困惑":"714eeb4eae0d0933b4ff08b7df788b1982f6b940.png","2233娘_耶":"d7178e258a0efc969b65ccc2b1322fb235f5dff4.png","2233娘_怒":"f31953119c51b9748016440ac0b632f779929b37.png","2233娘_卖萌":"ea893aa25355de95ab4f03c2dad3f0c58d0c159e.png","2233娘_委屈":"d9d0bf9d358af8d5761093ec66d4e3f60d963a63.png","2233娘_郁闷":"485203fe7100f2c8fc40b2800a18fe20b35f2f1a.png","2233娘_第一":"3754ee6e5985bd0bd7dfb668981f2a8733398ebd.png","2233娘_喝水":"695bf5429472049b52c1e0de586f8a2511195a23.png","2233娘_吐魂":"e999af499edf38a91ca68b1a9d2f97042c1d6734.png","2233娘_无言":"fdb5870f32cfaf7949e0f88a13f6feba4a48b719.png","热词系列_增加":"142409b595982b8210b2958f3d340f3b47942645.png","热词系列_泪目":"bba3703ab90b7d16fe9dbcb85ed949db687f8331.png","热词系列_保护":"55f8f6445ca7c3170cdfc5b16036abf639ce9b57.png","热词系列_害怕":"d77e2de26da143249f0c0ad7a608c27152c985bf.png","热词系列_爱了爱了":"2a165b555ba20391316366c664ed7891883dc5aa.png","热词系列_问号":"c1d1e76c12180adc8558f47006fe0e7ded4154bb.png","热词系列_吹爆":"b528220f9c37256ed6a37f05bf118e44b08b81e5.png","热词系列_三连":"21f15fe11b7a84d2f2121c16dec50a4e4556f865.png","热词系列_可以":"e08543c71202b36c590094417fcfbb80c3506cd8.png","热词系列_打卡":"a9cf77c78e1b9b40aa3ed4862402fba008ee2f51.png","热词系列_妙啊":"0e98299d7decf5eaffad854977946075c3e91cb8.png","热词系列_这次一定":"a01ca28923daa7cc896c42f27deb4914e20dd572.png","热词系列_AWSL":"c37f88cf799f9badf9d84b7671dc3dd98c0fc0c2.png","热词系列_递话筒":"98e6950e39fbb4dd1c576042063ca632074070ba.png","热词系列_你细品":"535e00658e7e47966f154d3a167fa2365ebc4321.png","热词系列_咕咕":"d8065c2e7ce48c929317a94553499a46fecc262a.png","热词系列_标准结局":"3de98174b510cf7dc5fd1bd08c5d881065e79137.png","热词系列_危":"5cc6c3357c4df544dd8de9d5c5c0cec97c7c9a56.png","热词系列_张三":"255a938f39cea625032b6650036b31aa26c50a3c.png","热词系列_害":"cbe798a194612958537c5282fcca7c3bcd2aa15c.png","热词系列_我裂开了":"29bd57ec4e8952880fea6c9e47aee924e91f10c4.png","热词系列_有内味了":"7ca61680a905b5b6e2e335c630e725b648b03b4d.png","热词系列_猛男必看":"c97064450528a0e45c7e7c365a15fbb13fd61d8c.png","热词系列_奥力给":"c9b8683827ec6c00fea5327c9bec14f581cef2aa.png","热词系列_我哭了":"9e0b3877d649aaf6538fbdd3f937e240a9d808e4.png","热词系列_高产":"9db817cba4a7f4a42398f3b2ec7c0a8e0c247c42.png","热词系列_我酸了":"a8cbf3f6b8cd9377eeb15b9172f3cd683b2e4650.png","热词系列_真香":"e68497c775feaac1c3b1a6cd63a50cfb11b767c4.png","热词系列_我全都要":"d424d1ad8d14c1c9b8367842bc68c658b9229bc1.png","热词系列_神仙UP":"a49e0d0db1e7d35a0f7411be13208951ab448f03.png","热词系列_你币有了":"84820c2b147a8ca02f3c4006b63f76c6313cbfa0.png","热词系列_不愧是你":"9ff2e356797c57ee3b1675ade0883d2d2247be9b.png","热词系列_锤":"35668cc12ae25b9545420e4a85bf21a0bfc03e5d.png","热词系列_秀":"50782fbf5d9b7f48f9467b5c53932981e321eedc.png","热词系列_爷关更":"faad40c56447f1f8abcb4045c17ce159d113d1fd.png","热词系列_有生之年":"f41fdafe2d0fbb8e8bc1598d2cf37e355560103a.png","热词系列_镇站之宝":"24e7a6a6e6383c987215fb905e3ee070aca259b5.png","热词系列_我太男了":"a523f3e4c63e4db1232365765d0ec452f83be97e.png","热词系列_完结撒花":"ea9db62ff5bca8e069cd70c4233353a802835422.png","热词系列_大师球":"f30089248dd137c568edabcb07cf67e0f6e98cf3.png","热词系列_知识盲区":"ccc94600b321a28116081e49ecedaa4ee8728312.png","热词系列_“狼火”":"33ccd3617bfa89e9d1498b13b7542b63f163e5de.png","加油武汉":"eb966aaa5b690d3f9308a9f936f5b5a72a7f956b.png","口罩":"3ad2f66b151496d2a5fb0a8ea75f32265d778dd3.png","鸡腿":"c7860392815d345fa69c4f00ef18d67dccfbd574.png","微笑":"685612eadc33f6bc233776c6241813385844f182.png","笑":"81edf17314cea3b48674312b4364df44d5c01f17.png","呲牙":"b5a5898491944a4268360f2e7a84623149672eb6.png","OK":"4683fd9ffc925fa6423110979d7dcac5eda297f4.png","星星眼":"63c9d1a31c0da745b61cdb35e0ecb28635675db2.png","哦呼":"362bded07ea5434886271d23fa25f5d85d8af06c.png","嫌弃":"de4c0783aaa60ec03de0a2b90858927bfad7154b.png","喜欢":"8a10a4d73a89f665feff3d46ca56e83dc68f9eb8.png","酸了":"92b1c8cbceea3ae0e8e32253ea414783e8ba7806.png","大哭":"2caafee2e5db4db72104650d87810cc2c123fc86.png","害羞":"9d2ec4e1fbd6cb1b4d12d2bbbdd124ccb83ddfda.png","无语":"44667b7d9349957e903b1b62cb91fb9b13720f04.png","疑惑":"b7840db4b1f9f4726b7cb23c0972720c1698d661.png","调皮":"8290b7308325e3179d2154327c85640af1528617.png","喜极而泣":"485a7e0c01c2d70707daae53bee4a9e2e31ef1ed.png","奸笑":"bb84906573472f0a84cebad1e9000eb6164a6f5a.png","偷笑":"6c49d226e76c42cd8002abc47b3112bc5a92f66a.png","大笑":"ca94ad1c7e6dac895eb5b33b7836b634c614d1c0.png","阴险":"ba8d5f8e7d136d59aab52c40fd3b8a43419eb03c.png","捂脸":"6921bb43f0c634870b92f4a8ad41dada94a5296d.png","囧":"12e41d357a9807cc80ef1e1ed258127fcc791424.png","呆":"33ad6000d9f9f168a0976bc60937786f239e5d8c.png","抠鼻":"cb89184c97e3f6d50acfd7961c313ce50360d70f.png","惊喜":"0afecaf3a3499479af946f29749e1a6c285b6f65.png","惊讶":"f8e9a59cad52ae1a19622805696a35f0a0d853f3.png","笑哭":"c3043ba94babf824dea03ce500d0e73763bf4f40.png","妙啊":"b4cb77159d58614a9b787b91b1cd22a81f383535.png","doge":"bba7c12aa51fed0199c241465560dfc2714c593e.png","滑稽":"d15121545a99ac46774f1f4465b895fe2d1411c3.png","吃瓜":"4191ce3c44c2b3df8fd97c33f85d3ab15f4f3c84.png","打call":"431432c43da3ee5aab5b0e4f8931953e649e9975.png","点赞":"1a67265993913f4c35d15a6028a30724e83e7d35.png","鼓掌":"895d1fc616b4b6c830cf96012880818c0e1de00d.png","尴尬":"cb321684ed5ce6eacdc2699092ab8fe7679e4fda.png","冷":"cb0ebbd0668640f07ebfc0e03f7a18a8cd00b4ed.png","灵魂出窍":"43d3db7d97343c01b47e22cfabeca84b4251f35a.png","委屈":"d2f26cbdd6c96960320af03f5514c5b524990840.png","傲娇":"010540d0f61220a0db4922e4a679a1d8eca94f4e.png","疼":"905fd9a99ec316e353b9bd4ecd49a5f0a301eabf.png","吓":"9c10c5ebc7bef27ec641b8a1877674e0c65fea5d.png","生病":"0f25ce04ae1d7baf98650986454c634f6612cb76.png","吐":"06946bfe71ac48a6078a0b662181bb5cad09decc.png","嘘声":"e64af664d20716e090f10411496998095f62f844.png","捂眼":"c5c6d6982e1e53e478daae554b239f2b227b172b.png","思考":"cfa9b7e89e4bfe04bbcd34ccb1b0df37f4fa905c.png","再见":"fc510306bae26c9aec7e287cdf201ded27b065b9.png","翻白眼":"eba54707c7168925b18f6f8b1f48d532fe08c2b1.png","哈欠":"888d877729cbec444ddbd1cf4c9af155a7a06086.png","奋斗":"bb2060c15dba7d3fd731c35079d1617f1afe3376.png","墨镜":"3a03aebfc06339d86a68c2d893303b46f4b85771.png","撇嘴":"531863568e5668c5ac181d395508a0eeb1f0cda4.png","难过":"a651db36701610aa70a781fa98c07c9789b11543.png","抓狂":"4c87afff88c22439c45b79e9d2035d21d5622eba.png","生气":"3195714219c4b582a4fb02033dd1519913d0246d.png","干杯":"8da12d5f55a2c7e9778dcc05b40571979fe208e6.png","爱心":"ed04066ea7124106d17ffcaf75600700e5442f5c.png","锦鲤":"643d6c19c8164ffd89e3e9cdf093cf5d773d979c.png","胜利":"b49fa9f4b1e7c3477918153b82c60b114d87347c.png","加油":"c7aaeacb21e107292d3bb053e5abde4a4459ed30.png","保佑":"fafe8d3de0dc139ebe995491d2dac458a865fb30.png","抱拳":"89516218158dbea18ab78e8873060bf95d33bbbe.png","响指":"1b5c53cf14336903e1d2ae3527ca380a1256a077.png","支持":"3c210366a5585706c09d4c686a9d942b39feeb50.png","拥抱":"41780a4254750cdaaccb20735730a36044e98ef3.png","怪我咯":"07cc6077f7f7d75b8d2c722dd9d9828a9fb9e46d.png","跪了":"f2b3aee7e521de7799d4e3aa379b01be032698ac.png","黑洞":"e90ec4c799010f25391179118ccd9f66b3b279ba.png","老鼠":"8e6fb491eb1bb0d5862e7ec8ccf9a3da12b6c155.png","福到了":"5de5373d354c373cf1617b6b836f3a8d53c5a655.png"},
  enableQQ: true,
  requiredFields: requiredFields,
  master: master,
  friends: friends,
  metaPlaceholder: {"nick":"昵称/QQ号(必填)","mail":"邮箱(必填)","link":"网址(https://)"}
});</script></div></article></main><footer id="footer" style="background-image: url(https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=4135708617,3847637319&amp;fm=26&amp;gp=0.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By csde`Blog</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/gh/1790735465/static/js/title.js"></script></body></html>